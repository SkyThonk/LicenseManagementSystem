@model LicenseManagement.Web.ViewModels.Documents.DocumentListViewModel
@{
    ViewData["Title"] = "Documents";
}

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-content">
        <h1 class="page-title">Documents</h1>
        <p class="page-description">Manage all uploaded documents</p>
    </div>
    <div class="page-header-actions">
        <a href="/documents/upload" class="btn btn-primary">
            <i class="fas fa-upload"></i>
            Upload Document
        </a>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="filter-form">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="form-label">Search</label>
                    <input type="text" name="search" value="@Model.SearchQuery" class="form-control" placeholder="Search by filename, type...">
                </div>
                <div class="filter-group">
                    <label class="form-label">Document Type</label>
                    <select name="type" class="form-select">
                        <option value="">All Types</option>
                        <option value="License Agreement" selected="@(Model.TypeFilter == "License Agreement")">License Agreement</option>
                        <option value="Identity Document" selected="@(Model.TypeFilter == "Identity Document")">Identity Document</option>
                        <option value="Insurance" selected="@(Model.TypeFilter == "Insurance")">Insurance</option>
                        <option value="Contract" selected="@(Model.TypeFilter == "Contract")">Contract</option>
                        <option value="Other" selected="@(Model.TypeFilter == "Other")">Other</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button type="submit" class="btn btn-secondary">
                        <i class="fas fa-filter"></i> Filter
                    </button>
                    <a href="/documents" class="btn btn-outline">Clear</a>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Documents Grid -->
<div class="documents-grid">
    @foreach (var doc in Model.Documents.Items)
    {
        <div class="document-card">
            <div class="document-icon @GetIconClass(doc.MimeType)">
                <i class="@GetFileIcon(doc.MimeType)"></i>
            </div>
            <div class="document-info">
                <h4 class="document-name" title="@doc.FileName">@TruncateFileName(doc.FileName)</h4>
                <span class="document-type">@doc.DocumentType</span>
                <div class="document-meta">
                    <span><i class="fas fa-hdd"></i> @(doc.SizeInKb.HasValue ? $"{doc.SizeInKb} KB" : "N/A")</span>
                    <span><i class="fas fa-calendar"></i> @doc.UploadedAt.ToString("MMM dd, yyyy")</span>
                </div>
                @if (!string.IsNullOrEmpty(doc.LicenseNumber))
                {
                    <span class="document-license">
                        <i class="fas fa-key"></i> @doc.LicenseNumber
                    </span>
                }
            </div>
            <div class="document-actions">
                <a href="/documents/download/@doc.Id" class="btn btn-sm btn-primary" title="Download">
                    <i class="fas fa-download"></i>
                </a>
                <form method="post" action="/documents/delete/@doc.Id" style="display: inline;"
                      onsubmit="return confirm('Are you sure you want to delete this document?');">
                    @Html.AntiForgeryToken()
                    <button type="submit" class="btn btn-sm btn-outline-danger" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </form>
            </div>
        </div>
    }
</div>

@if (!Model.Documents.Items.Any())
{
    <div class="empty-state">
        <i class="fas fa-folder-open"></i>
        <h3>No documents found</h3>
        <p>Upload your first document to get started.</p>
        <a href="/documents/upload" class="btn btn-primary">
            <i class="fas fa-upload"></i> Upload Document
        </a>
    </div>
}

@if (Model.Documents.TotalPages > 1)
{
    <div class="pagination-wrapper">
        <vc:pagination current-page="@Model.Documents.PageNumber" 
                      total-pages="@Model.Documents.TotalPages" 
                      page-size="@Model.Documents.PageSize" />
    </div>
}

@section Styles {
    <style>
        .mb-4 { margin-bottom: 1rem; }
        
        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1rem;
        }
        
        .document-card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: 1.25rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
            transition: box-shadow 0.2s, transform 0.2s;
        }
        
        .document-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .document-icon {
            width: 48px;
            height: 48px;
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .document-icon.pdf {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }
        
        .document-icon.image {
            background: rgba(59, 130, 246, 0.1);
            color: #3b82f6;
        }
        
        .document-icon.word {
            background: rgba(37, 99, 235, 0.1);
            color: #2563eb;
        }
        
        .document-icon.default {
            background: rgba(107, 114, 128, 0.1);
            color: #6b7280;
        }
        
        .document-info {
            flex: 1;
        }
        
        .document-name {
            font-size: 0.875rem;
            font-weight: 600;
            color: var(--gray-800);
            margin: 0 0 0.25rem 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .document-type {
            font-size: 0.75rem;
            color: var(--gray-500);
            display: block;
            margin-bottom: 0.5rem;
        }
        
        .document-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.75rem;
            color: var(--gray-400);
        }
        
        .document-meta i {
            margin-right: 0.25rem;
        }
        
        .document-license {
            display: inline-block;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--primary);
        }
        
        .document-license i {
            margin-right: 0.25rem;
        }
        
        .document-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
        }
        
        .empty-state i {
            font-size: 3rem;
            color: var(--gray-300);
            margin-bottom: 1rem;
        }
        
        .empty-state h3 {
            margin: 0 0 0.5rem 0;
            color: var(--gray-700);
        }
        
        .empty-state p {
            color: var(--gray-500);
            margin-bottom: 1.5rem;
        }
        
        .pagination-wrapper {
            margin-top: 1.5rem;
        }
    </style>
}

@functions {
    private string GetIconClass(string mimeType)
    {
        if (mimeType.Contains("pdf")) return "pdf";
        if (mimeType.Contains("image")) return "image";
        if (mimeType.Contains("word") || mimeType.Contains("document")) return "word";
        return "default";
    }

    private string GetFileIcon(string mimeType)
    {
        if (mimeType.Contains("pdf")) return "fas fa-file-pdf";
        if (mimeType.Contains("image")) return "fas fa-file-image";
        if (mimeType.Contains("word") || mimeType.Contains("document")) return "fas fa-file-word";
        if (mimeType.Contains("excel") || mimeType.Contains("spreadsheet")) return "fas fa-file-excel";
        return "fas fa-file";
    }

    private string TruncateFileName(string fileName)
    {
        if (fileName.Length <= 30) return fileName;
        var extension = System.IO.Path.GetExtension(fileName);
        var name = System.IO.Path.GetFileNameWithoutExtension(fileName);
        return name.Substring(0, 25) + "..." + extension;
    }
}
