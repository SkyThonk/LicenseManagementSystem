@model LicenseManagement.Web.ViewModels.Licenses.LicenseListViewModel
@{
    ViewData["Title"] = "Licenses";
}

<!-- Page Header -->
<div class="page-header">
    <div class="page-header-content">
        <h1 class="page-title">Licenses</h1>
        <p class="page-description">Manage all license applications and renewals</p>
    </div>
    <div class="page-header-actions">
        <a href="/licenses/create" class="btn btn-primary">
            <i class="fas fa-plus"></i>
            New License
        </a>
    </div>
</div>

<!-- Filters -->
<div class="card mb-4">
    <div class="card-body">
        <form method="get" class="filter-form">
            <div class="filter-row">
                <div class="filter-group">
                    <label class="form-label">Search</label>
                    <input type="text" name="search" value="@Model.SearchQuery" class="form-control" placeholder="Search by license number, applicant...">
                </div>
                <div class="filter-group">
                    <label class="form-label">Status</label>
                    <select name="status" class="form-select">
                        <option value="">All Statuses</option>
                        <option value="Active" selected="@(Model.StatusFilter == "Active")">Active</option>
                        <option value="Pending" selected="@(Model.StatusFilter == "Pending")">Pending</option>
                        <option value="Expiring" selected="@(Model.StatusFilter == "Expiring")">Expiring Soon</option>
                        <option value="Expired" selected="@(Model.StatusFilter == "Expired")">Expired</option>
                        <option value="Suspended" selected="@(Model.StatusFilter == "Suspended")">Suspended</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label class="form-label">Type</label>
                    <select name="type" class="form-select">
                        <option value="">All Types</option>
                        <option value="Enterprise" selected="@(Model.TypeFilter == "Enterprise")">Enterprise</option>
                        <option value="Professional" selected="@(Model.TypeFilter == "Professional")">Professional</option>
                        <option value="Basic" selected="@(Model.TypeFilter == "Basic")">Basic</option>
                        <option value="Trial" selected="@(Model.TypeFilter == "Trial")">Trial</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button type="submit" class="btn btn-secondary">
                        <i class="fas fa-filter"></i> Filter
                    </button>
                    <a href="/licenses" class="btn btn-outline">Clear</a>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Licenses Table -->
<div class="card">
    <div class="table-wrapper">
        <table class="table">
            <thead>
                <tr>
                    <th>License</th>
                    <th>Type</th>
                    <th>Applicant</th>
                    <th>Tenant</th>
                    <th>Status</th>
                    <th>Expiry Date</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var license in Model.Licenses.Items)
                {
                    <tr>
                        <td>
                            <a href="/licenses/@license.Id" class="table-cell-link">
                                @license.LicenseNumber
                            </a>
                        </td>
                        <td>
                            <span class="badge badge-@GetTypeBadgeColor(license.LicenseType)">
                                @license.LicenseType
                            </span>
                        </td>
                        <td>@license.ApplicantName</td>
                        <td>@license.TenantName</td>
                        <td>
                            <span class="badge badge-@GetStatusBadgeColor(license.Status)">
                                @license.Status
                            </span>
                        </td>
                        <td class="table-cell-date">
                            @if (license.ExpiryDate.HasValue)
                            {
                                @license.ExpiryDate.Value.ToString("MMM dd, yyyy")
                            }
                            else
                            {
                                <span class="text-muted">N/A</span>
                            }
                        </td>
                        <td>
                            <div class="table-actions">
                                <a href="/licenses/@license.Id" class="btn btn-sm btn-outline" title="View Details">
                                    <i class="fas fa-eye"></i>
                                </a>
                                <a href="/licenses/edit/@license.Id" class="btn btn-sm btn-outline" title="Edit">
                                    <i class="fas fa-edit"></i>
                                </a>
                                <div class="dropdown">
                                    <button class="btn btn-sm btn-outline dropdown-toggle" data-dropdown-toggle>
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>
                                    <div class="dropdown-menu">
                                        @if (license.Status != "Active")
                                        {
                                            <form method="post" action="/licenses/activate/@license.Id">
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="dropdown-item">
                                                    <i class="fas fa-check"></i> Activate
                                                </button>
                                            </form>
                                        }
                                        else
                                        {
                                            <form method="post" action="/licenses/deactivate/@license.Id">
                                                @Html.AntiForgeryToken()
                                                <button type="submit" class="dropdown-item">
                                                    <i class="fas fa-pause"></i> Deactivate
                                                </button>
                                            </form>
                                        }
                                        <form method="post" action="/licenses/delete/@license.Id" 
                                              onsubmit="return confirm('Are you sure you want to delete this license?');">
                                            @Html.AntiForgeryToken()
                                            <button type="submit" class="dropdown-item text-danger">
                                                <i class="fas fa-trash"></i> Delete
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    @if (Model.Licenses.TotalPages > 1)
    {
        <div class="card-footer">
            <vc:pagination current-page="@Model.Licenses.PageNumber" 
                          total-pages="@Model.Licenses.TotalPages" 
                          page-size="@Model.Licenses.PageSize" />
        </div>
    }
</div>

@functions {
    private string GetStatusBadgeColor(string status) => status switch
    {
        "Active" => "success",
        "Pending" => "warning",
        "Expiring" => "warning",
        "Expired" => "danger",
        "Suspended" => "secondary",
        _ => "secondary"
    };

    private string GetTypeBadgeColor(string type) => type switch
    {
        "Enterprise" => "primary",
        "Professional" => "info",
        "Basic" => "secondary",
        "Trial" => "warning",
        _ => "secondary"
    };
}
